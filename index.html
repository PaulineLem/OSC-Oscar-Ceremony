<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <script src="https://d3js.org/d3.v4.min.js"></script>
      <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
   <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-alpha.4/js/materialize.min.js"></script>
          
  <style>
    body { margin:0;top:0;right:0;bottom:0;left:0; }
  </style>
</head>


<body >

  
  

  
    <div class="input-field col s12">
    <select multiple id = "category">
    </select>
    <label>Select category</label>
  </div>
  <div class="input-field col s12">
      <div> </div>

    <h3 id = "selected_year"> </h3>

  <div id="my_dataviz"></div>
  

  

  
  
 

  <script>
  
var categories = ['ACTRESS IN A LEADING ROLE', 'ACTOR IN A LEADING ROLE', 'ACTRESS IN A SUPPORTING ROLE', 'ACTOR IN A SUPPORTING ROLE'];
    
    
categories.forEach(function(cat) {
    var x = document.getElementById("category");
    var option = document.createElement("option");
    option.text = cat;
    x.add(option);
});
    
    
(function($){
  $(function(){
    // Plugin initialization
    $('select').not('.disabled').formSelect();
  }); 
})(jQuery); // end of jQuery name space
  
var selected_category = []
var selected_year = 2001


var w = window,
    d = document,
    e = d.documentElement,
    g = d.getElementsByTagName('body')[0],
    x = w.innerWidth || e.clientWidth || g.clientWidth,
    y = w.innerHeight|| e.clientHeight|| g.clientHeight;



  
    
var margin = {top: 50, right: 20, bottom: 20, left: 20};
   
var width = x- margin.left - margin.right,
    height = y - margin.top - margin.bottom;
        
var svg = d3.select("body").append("svg")
    .attr("width", x)
    .attr("height", y)  


 var data = d3.json('https://raw.githubusercontent.com/PaulineLem/OSC-Oscar-Ceremony/master/data_json_v2_pict.json', function(error, dataset){ 


var space = [width/2, height]
       

       
$("#category").change(function() {     
selected_category = $('select#category').val()
  
if (Array.isArray(selected_category) === false){
        selected_category = [selected_category]
      }
 svg.selectAll("*").remove();
 launch_drawing(selected_year, selected_category, dataset,  margin, space)
    });
 
var scale_x = d3.scaleLinear()
    .range([ margin.left + space[0], 2 *space[0] ])
    .domain([2000, 2018])

svg.on("click", function() {

    var coords = d3.mouse(this);
    if ((coords[0] > margin.left + space[0]) && (coords[0]< 2 *space[0]) && (coords[1] > margin.top ) && (coords[1] <space[1])) {
            if (scale_x.invert(coords[0])- Math.floor(scale_x.invert(coords[0]))>0.5) {
            selected_year =Math.ceil(scale_x.invert(coords[0]))
        }
        else {
            selected_year =Math.floor(scale_x.invert(coords[0]))
        }
        svg.selectAll(".selected_year").remove();
        svg.selectAll("*").remove();

    document.getElementById('selected_year').textContent = selected_year;

    launch_drawing(selected_year, selected_category, dataset,  margin, space )
}

})
  

  ;

              
 })
function launch_drawing(selected_year, selected_category, dataset,  margin, space ){
    if (selected_year && selected_category) {
        draw_selected_year(margin.left + space[0], 2 *space[0], margin.top , space[1],  selected_year)

        for (var j = 0; j < selected_category.length; j++) {
            draw_res(dataset, margin.left, space[0], margin.top, space[1], selected_category[j], selected_year,j, 'plot'+(j+1).toString())

            draw_scatter(dataset,margin.left + space[0], 2 *space[0], margin.top , space[1],  selected_category[j], selected_year,  true, 'plot'+(j*10+1).toString())
        }
}
    


  ;}

  function color_circle(act){
         if (act.winner === "True") {return "yellow"}
         else {return "white"}

     }


     function draw_selected_year( x_start, x_end,  y_start, y_end, selected_year){

    var scale_x = d3.scaleLinear()
    .range([ x_start, x_end ])
    .domain([2000, 2018])
        var boxWidth = 25

svg.selectAll(".selected_year").remove();
svg.append("rect")
  .attr("class", "selected_year")
  .attr("x", scale_x(selected_year)-boxWidth/2)
  .attr("y", y_start)
  .attr("height", y_end-y_start)
  .attr("width", boxWidth )
  .attr("stroke", "grey")
  .attr("fill-opacity", 0.3)
  .style("fill", "grey")
     }


     function draw_scatter(data, x_start, x_end, y_start, y_end, category, selected_year, winner, id) {

       
			var parsedTime = d3.timeParse("%Y-%m-%d")
      var displayTime = d3.timeFormat("%Y-%m-%d") 
			let liste = []
			data.forEach(function(line) {
        if (line.category=== category && (parseInt(line.year) >2000)) {
          let line_out = line
              
          var start = new Date(parseInt(line.year), 02, 01); 
          var end = parsedTime(line.date)
  
        // Calling the timeDay() function to 
        // calculate the difference between two dates 
        	var a = d3.timeYear.count(end, start); 
         line_out["age"] = a
  
        // Getting the calculated dates 

           
//           console.log(line_out["age"])
          liste.push(line_out)
                      
      }
        
        
     })

  var sumstat = d3.nest() // nest function allows to group the calculation per level of a factor
    .key(function(d) {return parseInt(d.year);})
    .rollup(function(d) {
      q1 = d3.quantile(d.map(function(g) { return parseInt(g.age);}).sort(d3.ascending),.25)
      median = d3.quantile(d.map(function(g) { return parseInt(g.age);}).sort(d3.ascending),.5)
      q3 = d3.quantile(d.map(function(g) { return parseInt(g.age);}).sort(d3.ascending),.75)
      interQuantileRange = q3 - q1
      min = q1 - 1.5 * interQuantileRange
      max = q3 + 1.5 * interQuantileRange
      return( {q1: q1, median: median, q3: q3, interQuantileRange: interQuantileRange, min: min, max: max})
      
    })
    .entries(liste)
  

  
    // Show the X scale
  var scale_x = d3.scaleLinear()
    .range([ x_start, x_end ])
    .domain([2000, 2018])

  svg.append("g")
    .attr("transform", "translate(0," + height + ")")
    .call(d3.axisBottom(scale_x))


  // Show the Y scale
  var y = d3.scaleLinear()
    .domain([0,100])
    .range([y_end, y_start])

  svg.append("g")
    .attr("transform", "translate("+ x_start.toString() +", 0)")
  .call(d3.axisLeft().scale(y))







var jitterWidth = 10
svg
  .selectAll("indPoints")
  .data(liste)
  .enter()
  .append("circle")
    .attr("cx", function(d){ return(scale_x(parseInt(d.year)) - jitterWidth/2 + Math.random()*jitterWidth )})
    .attr("cy", function(d){return(y(d.age))})
    .attr("r", 4)
    .style("fill", function(d) {return color_circle(d)})
    .attr("stroke", "black")

    .on("mouseover", function(e){
         d3.selectAll('Text')
        .style('fill', function(d) {
           if (d.entity===e.entity) {
             return '#b7a164'
           } else {
             return 'grey'
           }
         })
         d3.selectAll('Circle')
         .style('fill', function(d) {
           if (d.entity===e.entity) {
             return 'red'
           } else {
             return color_circle(d)
           }
         })
        .attr('r', function(d) {
           if (d===e) {
             return 6
           } else {
             return 4
           }
         })

        
      })
       .on("mouseout", function(e){
         d3.selectAll('Text')
        .style('fill', 'grey')
         d3.selectAll('Circle')
       .style('fill', function(d) {return color_circle(d)})
       .attr('r', 4)
  
     })




}





  function draw_list(data, x_start, x_end, y_start, y_end, category, winner, id) {
      
  
     	var parsedTime = d3.timeParse("%Y-%m-%d")
      var displayTime = d3.timeFormat("%Y-%m-%d") 
			let liste = []
			data.forEach(function(line) {
        if (line.category=== category && line.winner === "True") {
          liste.push(line)                  
      }
        
        
     })  
       
      svg.selectAll('.'+id).
      data(liste).enter()
      	.append('text')
      	.attr("x",  x_start + margin.left)
      	.attr("y", function(d,i){return y_start + 30*(i+1)} )
        .attr('stroke-width', 1)
        .style('fill', 'black')
   			.style('stroke','')
      	.text(function(d) { return d.year})
      
     svg.selectAll('.'+id).
      data(liste).enter()
      	.append('text')
      	.attr("x",  x_start + margin.left + 40)
      	.attr("y", function(d,i){return y_start +30*(i+1)} )
        .attr('stroke-width', 1)
        .style('fill', 'black')
   			.style('stroke','')
      	.text(function(d) { return d.entity})
     .on("mouseover", function(e){
         d3.selectAll('Text')
        .style('fill', function(d) {
           if (d===e) {
             return '#b7a164'
           } else {
             return 'black'
           }
         })
         d3.selectAll('Circle')
         .style('fill', function(d) {
           if (d===e) {
             return 'grey'
           } else {
             return 'white'
           }
         })

        
      })
       .on("mouseout", function(d){
         d3.selectAll('Text')
        .style('fill', 'black')
         d3.selectAll('Circle')
       .style('fill', 'white')

         

     })
     
            
          
     svg.selectAll('.'+id).
      data(liste).enter()
     .append('image')
     .attr("x",  x_start + margin.left + 200)
     .attr("y", function(d,i){return y_start +30*(i)} )
    .attr('xlink:href', function(d) {
       var link = "https://www.salonlfc.com/wp-content/uploads/2018/01/image-not-found-1-scaled-1150x647.png"
       if (d["picture_link"]) {link = d["picture_link"]}
       return link})
    .attr('width', 30)
    .attr('height', 30)
    
  }
  

    
    function draw_res(data, x_start, x_end, y_start, y_end, category, year, j_id,  id) {

      
  
     	var parsedTime = d3.timeParse("%Y-%m-%d")
      var displayTime = d3.timeFormat("%Y-%m-%d") 
			let liste = []
			data.forEach(function(line) {
        if (line.category=== category && parseInt(line.year) === year) {
          liste.push(line)                  
      }     
     })  
       


      
      
           svg.selectAll('.'+id).
      data(liste).enter()
     .append('image')
     .attr("x",  function(d,i){return x_start +110*(i)} )
     .attr("y", y_start+170*j_id)
    .attr('xlink:href', function(d) {
       var link = "https://www.salonlfc.com/wp-content/uploads/2018/01/image-not-found-1-scaled-1150x647.png"
       if (d["picture_link"]) {link = d["picture_link"]}
       return link})
    .attr('width', 90)
    .attr('height', 90)
    .on("mouseover", function(e){
         d3.selectAll('Text')
        .style('fill', function(d) {
           if (d.entity===e.entity) {
             return '#b7a164'
           } else {
             return 'grey'
           }
         })
         d3.selectAll('Circle')
         .style('fill', function(d) {
           if (d.entity===e.entity) {
             return 'red'
           } else {
             return color_circle(d)
           }
         })
        .attr('r', function(d) {
           if (d===e) {
             return 6
           } else {
             return 4
           }
         })

        
      })
       .on("mouseout", function(e){
         d3.selectAll('Text')
        .style('fill', 'grey')
         d3.selectAll('Circle')
       .style('fill', function(d) {return color_circle(d)})
       .attr('r', 4)

  
     })
      
     svg.selectAll('.'+id).
      data(liste).enter()
      	.append('text')
      	.attr("x",  function(d,i){return x_start +110*(i)})
      	.attr("y", y_start+170*j_id+110)
        .attr('stroke-width', 0.8)
        .style('fill', 'grey')
   		.style('stroke','')
      	.text(function(d) { return d.entity})
          .on("mouseover", function(e){
         d3.selectAll('Text')
        .style('fill', function(d) {
           if (d.entity===e.entity) {
             return '#b7a164'
           } else {
             return 'grey'
           }
         })
         d3.selectAll('Circle')
         .style('fill', function(d) {
           if (d.entity===e.entity) {
             return 'red'
           } else {
             return color_circle(d)
           }
         })
        .attr('r', function(d) {
           if (d===e) {
             return 6
           } else {
             return 4
           }
         })

        
      })
       .on("mouseout", function(e){
         d3.selectAll('Text')
        .style('fill', 'grey')
         d3.selectAll('Circle')
       .style('fill', function(d) {return color_circle(d)})
       .attr('r', 4)

  
     })
     
            
     
     
         svg.selectAll('.'+id).
      data(liste).enter()
     .append('image')
     .attr("x", function(d,i){return x_start +110*(i)+20}  )
     .attr("y", y_start+170*j_id+95)
    .attr('xlink:href', function(d) {
       var link = ""
       if (d.winner === "True"){
        link = "http://fr.web.img3.acsta.net/r_640_360/medias/nmedia/19/01/12/30/20642080.jpg"
       }
      return link})         
    .attr('width', 50)
    .attr('height', 50)
    
  }
   
  </script>
 
</body>
